FROM golang:1.13.1 as builder

ARG KUBEBUILDER_VERSION=2.0.1

ENV PATH=$PATH:/usr/local/kubebuilder/bin

WORKDIR /workspace

RUN curl -sL https://go.kubebuilder.io/dl/${KUBEBUILDER_VERSION}/linux/amd64 | tar -xz -C /tmp/ && \
    mv /tmp/kubebuilder_${KUBEBUILDER_VERSION}_linux_amd64 /usr/local/kubebuilder

COPY go.mod go.mod
COPY go.sum go.sum
RUN go mod download

COPY ./ ./

ENTRYPOINT ["make"]
